"use strict";var mapsError=window.setTimeout(function(){alert("The map was unable to load. Check your internet connection and try again.")},8e3),Model={locations:[]},ViewModel=function(){function a(a){var b=setTimeout(function(){alert("Unable to load venue data")},12e3);$.ajax({url:"http://localhost:3000/concerts",type:"GET",dataType:"json",data:a}).then(function(a){Model.locations=a.events.event,w.generateList(Model.locations),clearTimeout(b)})}function b(){var a=moment(w.currentDate()).format("MMMM Do YYYY");w.displayDate(a)}function c(){w.newEventfulRequest(),w.newLocation(),w.setDisplayDate(),w.currentLocation=w.home_location(),w.userInput(!1)}function d(){var a=w.home_location();w.geocodeLocation(a)}function e(){w.clearMarkers(),w.locationsList([]),w.venueArray=[],w.eventfulAjax(w.eventfulOptions())}function f(a){var b=a?a.toLowerCase():"";return b}function g(a){return w.regExp().test(a)}function h(){w.locationsList().forEach(function(a){null!==a.marker.getAnimation()&&a.marker.setAnimation(null)})}function i(a){a.setAnimation(google.maps.Animation.BOUNCE)}function j(a){null===a.getAnimation()&&(w.stopBounces(),w.toggleBounce(a))}function k(a){a.forEach(function(a){if(a.performers){var b=w.venueArray.indexOf(a.venue_name);if(-1===b)w.locationsList.push(new z(a)),w.venueArray.push(a.venue_name);else{var c=w.locationsList()[b];c.events.push(new y(a)),c.infoWindowContent=w.createInfoWindowContent(c),c.title(c.title()+" "+a.title),c.description(c.description+" "+a.description)}}})}function l(){window.clearTimeout(mapsError);var a=w.home,b={center:a,scrollwheel:!1,zoom:12,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM}};w.map=new google.maps.Map(document.getElementById("map"),b),w.infoWindow=new google.maps.InfoWindow,w.geocoder=new google.maps.Geocoder,google.maps.event.addListener(w.infoWindow,"closeclick",function(){w.stopBounces(),w.infoOpen(!1)})}function m(a){var b=a;w.geocoder.geocode({address:b},function(a,b){b===google.maps.GeocoderStatus.OK?w.map.setCenter(a[0].geometry.location):alert("Geocode was not successful for the following reason: "+b)})}function n(a,b){var c=new google.maps.Marker({position:a,map:w.map,title:b,animation:google.maps.Animation.DROP});return c}function o(a){w.infoWindow.close(),w.infoWindow.setContent(a.infoWindowContent),w.map.panTo(a.marker.position),w.checkBounce(a.marker),window.setTimeout(function(){w.infoWindow.open(w.map,a.marker),w.infoOpen(!0)},600),w.toggleSideBar()}function p(a){var b="";a.events().forEach(function(a){b+='<div class="event-img"><img src="'+a.image+'" class="image"></div><div class="event-details"><h4 class="artist">'+a.event_title+'</h4><h4 class="start-time">'+moment(a.start_time).format("MMM Do YYYY @ h:mm a")+'</h4></div><a class="event-details" href="'+a.url+'" class="link">Click Here for More Details</a><hr>'});var c='<div class="info-window"><h2 class="info-window-title">'+a.venue_name+"</h2>"+b+"</div>";return c}function q(a){ko.computed(function(){var b=w.map;a.displayLocation()||(b=null),a.marker.setMap(b)})}function r(){w.locationsList().forEach(function(a){a.marker.setMap(null)})}function s(){w.sideBar(!w.sideBar()),w.userInput()&&w.closeUserInput(),w.closeInfoWindow()}function t(){w.userInput(!0),w.sideBar(!1),w.closeInfoWindow()}function u(){w.userInput(!1)}function v(){w.infoWindow.close(),w.infoOpen(!1),w.stopBounces()}var w=this;w.home_location=ko.observable("Washington, DC");var x=$("#datepicker");x.datepicker({dateFormat:"yy-mm-dd"}),w.currentDate=ko.observable(x.datepicker("getDate")),w.currentDateFormatted=ko.computed(function(){var a=w.currentDate(),b=moment(a).format("YYYYMMDD")+"00",c=b+"-"+b;return c}),w.selectedDate=ko.computed(function(){var a=w.currentDate(),b=moment(a).format("MMM Do YYYY");return b}),w.displayDate=ko.observable("today"),w.eventfulOptions=ko.computed(function(){var a={};return a.category="music",a.location=w.home_location(),a.date=w.currentDateFormatted(),a.page_size=20,a.sort_order="popularity",a.include="categories, price",a.change_multi_day_start=!0,a}),w.eventfulAjax=a,w.setDisplayDate=b,w.submitNew=c,w.newLocation=d,w.newEventfulRequest=e,w.eventfulAjax(w.eventfulOptions());var y=function(a){this.start_time=a.start_time,this.event_title=a.title,this.url=a.url,this.image=a.image?a.image.medium.url:""};w.Event=y;var z=function(a){var b=this;b.latLng={lat:parseFloat(a.latitude),lng:parseFloat(a.longitude)},b.venue_name=a.venue_name,b.short_name=b.venue_name.slice(0,35),b.events=ko.observableArray([]),b.events.push(new w.Event(a)),b.description=ko.observable(a.description),b.title=ko.observable(a.title),b.marker=w.createMapMarker(b.latLng,b.venue_name),b.infoWindowContent=w.createInfoWindowContent(b),b.bounce=!1,b.marker.addListener("click",function(){w.checkBounce(b.marker),w.infoWindow.close(),w.infoWindow.setContent(b.infoWindowContent),w.map.panTo(b.marker.position),window.setTimeout(function(){w.infoWindow.open(w.map,b.marker),w.infoOpen(!0)},600)}),this.displayLocation=ko.computed(function(){var a=w.lowerCase(b.venue_name),c=w.lowerCase(b.title()),d=w.lowerCase(b.description()),e=w.getResult(a),f=w.getResult(c),g=w.getResult(d),h=e||f||g?!0:!1;return h}),w.filterMarkers(b)};w.locationsList=ko.observableArray([]),w.lowerCase=f,w.filter=ko.observable(),w.regExp=ko.computed(function(){var a=w.lowerCase(w.filter()),b=new RegExp(a);return b}),w.getResult=g,w.stopBounces=h,w.toggleBounce=i,w.checkBounce=j,w.venueArray=[],w.generateList=k,w.home={lat:38.9071923,lng:-77.03687070000001},w.currentLocation="Washington, DC",w.infoOpen=ko.observable(),w.initMap=l,w.geocodeLocation=m,w.createMapMarker=n,w.locationClick=o,w.createInfoWindowContent=p,w.filterMarkers=q,w.clearMarkers=r,w.sideBar=ko.observable(!1),w.toggleSideBar=s,w.userInput=ko.observable(!1),w.openUserInput=t,w.closeUserInput=u,w.infoOpen=ko.observable(!1),w.closeInfoWindow=v,w.arrowUrl=ko.computed(function(){var a=w.sideBar()?"images/arrow-left.svg":"images/arrow-right.svg";return a}),$(".left-swipe-area").swipe({swipeRight:function(a,b,c,d,e,f){w.toggleSideBar()},swipeLeft:function(a,b,c,d,e,f){w.toggleSideBar()}}),$(".right-swipe-area").swipe({swipeRight:function(a,b,c,d,e,f){w.closeUserInput()},swipeLeft:function(a,b,c,d,e,f){w.openUserInput()}})},vm=new ViewModel;ko.applyBindings(vm);